!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ReeValidate=t()}(this,function(){"use strict";function i(e){return y(["radio","checkbox"],e.type)}function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e.every(function(e){return null==e})}function r(){return{untouched:!0,touched:!1,dirty:!1,pristine:!0,valid:null,invalid:null,validated:!1,pending:!1,required:!1,changed:!1}}function u(e,t,i){if(void 0===i&&(i=void 0),!e||!t)return i;var r=t;return e.split(".").every(function(e){return e in r?(r=r[e],!0):(r=i,!1)}),r}function a(r){return r?v(r)?Object.keys(r).reduce(function(e,t){var i=[],i=!0===r[t]?[]:Array.isArray(r[t])||v(r[t])?r[t]:[r[t]];return!1!==r[t]&&(e[t]=i),e},{}):"string"!=typeof r?(n("rules must be either a string or an object."),{}):r.split("|").reduce(function(e,t){var i,r,n,s=(r=[],n=(i=t).split(":")[0],y(i,":")&&(r=i.split(":").slice(1).join(":").split(",")),{name:n,params:r});return s.name&&(e[s.name]=s.params),e},{}):{}}function d(e){return new Error("[ree-validate] "+e)}function f(e){return"function"==typeof e}function l(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function p(e){if(f(Array.from))return Array.from(e);for(var t=[],i=e.length,r=0;r<i;r++)t.push(e[r]);return t}function s(e){for(var t=[],i=arguments.length-1;0<i--;)t[i]=arguments[i+1];if(f(Object.assign))return Object.assign.apply(Object,[e].concat(t));if(null==e)throw new TypeError("Cannot convert undefined or null to object");var r=Object(e);return t.forEach(function(t){null!=t&&Object.keys(t).forEach(function(e){r[e]=t[e]})}),r}function h(e,t){var i=Array.isArray(e)?e:p(e),r=function(e,t){for(var i=Array.isArray(e)?e:p(e),r=0;r<i.length;r++)if(t(i[r]))return r;return-1}(i,t);return-1===r?void 0:i[r]}function e(e){void 0===e&&(e={}),this.container={},this.merge(e)}var n=function(e){console.warn("[ree-validate] "+e)},v=function(e){return null!==e&&e&&"object"==typeof e&&!Array.isArray(e)},m=function(t,e,i){var r,n,s,a,o;if(t&&e){if(!Array.isArray(e))return i?(n=e,void((r=t).classList?r.classList.add(n):l(r,n)||(r.className+=" "+n))):(a=e,void((s=t).classList?s.classList.remove(a):l(s,a)&&(o=new RegExp("(\\s|^)"+a+"(\\s|$)"),s.className=s.className.replace(o," "))));e.forEach(function(e){return m(t,e,i)})}},t=0,o="{id}",g=function(r,n){return v(r)&&v(n)&&Object.keys(n).forEach(function(e){var t,i;return v(n[e])?(r[e]||s(r,((t={})[e]={},t)),void g(r[e],n[e])):void s(r,((i={})[e]=n[e],i))}),r},y=function(e,t){return-1!==e.indexOf(t)},b="en",_={locale:{configurable:!0}};_.locale.get=function(){return b},_.locale.set=function(e){b=e||"en"},e.prototype.hasLocale=function(e){return!!this.container[e]},e.prototype.setDateFormat=function(e,t){this.container[e]||(this.container[e]={}),this.container[e].dateFormat=t},e.prototype.getDateFormat=function(e){return this.container[e]&&this.container[e].dateFormat?this.container[e].dateFormat:null},e.prototype.getMessage=function(e,t,i){var r=null,r=this.hasMessage(e,t)?this.container[e].messages[t]:this._getDefaultMessage(e);return f(r)?r.apply(void 0,i):r},e.prototype.getFieldMessage=function(e,t,i,r){if(!this.hasLocale(e))return this.getMessage(e,i,r);var n=this.container[e].custom&&this.container[e].custom[t];if(!n||!n[i])return this.getMessage(e,i,r);var s=n[i];return f(s)?s.apply(void 0,r):s},e.prototype._getDefaultMessage=function(e){return this.hasMessage(e,"_default")?this.container[e].messages._default:this.container.en.messages._default},e.prototype.getAttribute=function(e,t,i){return void 0===i&&(i=""),this.hasAttribute(e,t)?this.container[e].attributes[t]:i},e.prototype.hasMessage=function(e,t){return!!(this.hasLocale(e)&&this.container[e].messages&&this.container[e].messages[t])},e.prototype.hasAttribute=function(e,t){return!!(this.hasLocale(e)&&this.container[e].attributes&&this.container[e].attributes[t])},e.prototype.merge=function(e){g(this.container,e)},e.prototype.setMessage=function(e,t,i){this.hasLocale(e)||(this.container[e]={messages:{},attributes:{}}),this.container[e].messages[t]=i},e.prototype.setAttribute=function(e,t,i){this.hasLocale(e)||(this.container[e]={messages:{},attributes:{}}),this.container[e].attributes[t]=i},Object.defineProperties(e.prototype,_);function F(){}var A={default:new e({en:{messages:{},attributes:{},custom:{}}})},j="default";F._checkDriverName=function(e){if(!e)throw d("you must provide a name to the dictionary driver")},F.setDriver=function(e,t){void 0===t&&(t=null),this._checkDriverName(e),t&&(A[e]=t),j=e},F.getDriver=function(){return A[j]};function O(e){void 0===e&&(e=null),this.items=e&&e instanceof O?e.items:[]}O.prototype["function"==typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var e=this,t=0;return{next:function(){return{value:e.items[t++],done:t>e.items.length}}}},O.prototype.add=function(e){var t;(t=this.items).push.apply(t,this._normalizeError(e))},O.prototype._normalizeError=function(e){return Array.isArray(e)?e.map(function(e){return e.scope=c(e.scope)?null:e.scope,e}):(e.scope=c(e.scope)?null:e.scope,[e])},O.prototype.regenerate=function(){this.items.forEach(function(e){e.msg=f(e.regenerate)?e.regenerate():e.msg})},O.prototype.update=function(t,e){var i,r=h(this.items,function(e){return e.id===t});r&&(i=this.items.indexOf(r),this.items.splice(i,1),r.scope=e.scope,this.items.push(r))},O.prototype.all=function(i){return this.items.filter(function(e){var t=!0;return c(i)||(t=e.scope===i),t}).map(function(e){return e.msg})},O.prototype.any=function(i){return!!this.items.filter(function(e){var t=!0;return c(i)||(t=e.scope===i),t}).length},O.prototype.clear=function(e){c(e)&&(e=null);for(var t=0;t<this.items.length;++t)this.items[t].scope===e&&(this.items.splice(t,1),--t)},O.prototype.collect=function(e,t,r){void 0===r&&(r=!0);function i(e){var t,i=e.reduce(function(e,t){return e[t.field]||(e[t.field]=[]),e[t.field].push(r?t.msg:t),e},{});return n?(t=i,(f(Object.values)?Object.values(t):t[Object.keys(t)[0]])[0]||[]):i}var n=!c(e)&&!e.includes("*");if(c(e))return i(this.items);var s=c(t)?String(e):t+"."+e,a=this._makeCandidateFilters(s),o=a.isPrimary,u=a.isAlt,l=this.items.reduce(function(e,t){return o(t)&&e.primary.push(t),u(t)&&e.alt.push(t),e},{primary:[],alt:[]});return i(l=l.primary.length?l.primary:l.alt)},O.prototype.count=function(){return this.items.length},O.prototype.firstById=function(t){var e=h(this.items,function(e){return e.id===t});return e?e.msg:void 0},O.prototype.first=function(e,t){void 0===t&&(t=null);var i=c(t)?e:t+"."+e,r=this._match(i);return r&&r.msg},O.prototype.firstRule=function(e,t){var i=this.collect(e,t,!1);return i.length&&i[0].rule||void 0},O.prototype.has=function(e,t){return void 0===t&&(t=null),!!this.first(e,t)},O.prototype.firstByRule=function(e,t,i){void 0===i&&(i=null);var r=this.collect(e,i,!1).filter(function(e){return e.rule===t})[0];return r&&r.msg||void 0},O.prototype.firstNot=function(e,t,i){void 0===t&&(t="required"),void 0===i&&(i=null);var r=this.collect(e,i,!1).filter(function(e){return e.rule!==t})[0];return r&&r.msg||void 0},O.prototype.removeById=function(t){var e=function(e){return e.id===t};Array.isArray(t)&&(e=function(e){return-1!==t.indexOf(e.id)});for(var i=0;i<this.items.length;++i)e(this.items[i])&&(this.items.splice(i,1),--i)},O.prototype.remove=function(e,t){if(!c(e))for(var i=c(t)?String(e):t+"."+e,r=this._makeCandidateFilters(i),n=r.isPrimary,s=r.isAlt,a=function(e){return n(t=e)||s(t);var t},o=0;o<this.items.length;++o)a(this.items[o])&&(this.items.splice(o,1),--o)},O.prototype._makeCandidateFilters=function(e){var t=function(){return!0},i=function(){return!0},r=function(){return!0},n=function(e){var t=null;if(y(e,":")&&(t=e.split(":").pop(),e=e.replace(":"+t,"")),"#"===e[0])return{id:e.slice(1),rule:t,name:null,scope:null};var i,r=null,n=e;return y(e,".")&&(r=(i=e.split("."))[0],n=i.slice(1).join(".")),{id:null,scope:r,name:n,rule:t}}(e),s=n.id,a=n.rule,o=n.scope,u=n.name;if(a&&(t=function(e){return e.rule===a}),s)return{isPrimary:function(e){return t(e)&&function(e){return s===e.id}},isAlt:function(){return!1}};i=c(o)?function(e){return c(e.scope)}:function(e){return e.scope===o},c(u)||"*"===u||(r=function(e){return e.field===u});return{isPrimary:function(e){return r(e)&&t(e)&&i(e)},isAlt:function(e){return t(e)&&e.field===o+"."+u}}},O.prototype._match=function(e){if(!c(e)){var t=this._makeCandidateFilters(e),s=t.isPrimary,a=t.isAlt;return this.items.reduce(function(e,t,i,r){var n=i===r.length-1;return e.primary?n?e.primary:e:(s(t)&&(e.primary=t),a(t)&&(e.alt=t),n?e.primary||e.alt:e)},{})}};function D(){}var E={},N={rules:{configurable:!0}};D.add=function(e,t){var i=t.validate,r=t.options,n=t.paramNames;E[e]={validate:i,options:r,paramNames:n}},N.rules.get=function(){return E},D.has=function(e){return!!E[e]},D.isImmediate=function(e){return!(!E[e]||!E[e].options.immediate)},D.isRequireRule=function(e){return!(!E[e]||!E[e].options.computesRequired)},D.isTargetRule=function(e){return!(!E[e]||!E[e].options.hasTarget)},D.remove=function(e){delete E[e]},D.getParamNames=function(e){return E[e]&&E[e].paramNames},D.getOptions=function(e){return E[e]&&E[e].options},D.getValidatorMethod=function(e){return E[e]?E[e].validate:null},Object.defineProperties(D,N);function k(e,t,i){e.addEventListener(t,i,{passive:!0})}function P(e){void 0===e&&(e={}),this.id=(9999<=t&&(t=0,o=o.replace("{id}","_{id}")),t++,o.replace("{id}",String(t))),this.updated=!1,this.dependencies=[],this.events=[],this.delay=0,this.rules={},this.forceRequired=!1,this.classNames=s({},x.classNames),e=s({},x,e),this._delay=c(e.delay)?0:e.delay,this.validity=e.validity,this.flags=r(),this.update(e),this.initialValue=this.value,this.updated=!1}var x={targetOf:null,immediate:!1,scope:null,listen:!0,name:null,rules:{},classes:!1,validity:!0,events:"change|blur",delay:0,classNames:{touched:"touched",untouched:"untouched",valid:"valid",invalid:"invalid",pristine:"pristine",dirty:"dirty"}},R={validator:{configurable:!0},isRequired:{configurable:!0},isDisabled:{configurable:!0},alias:{configurable:!0},value:{configurable:!0},bails:{configurable:!0},rejectsFalse:{configurable:!0}};R.validator.get=function(){return{validate:function(){}}},R.isRequired.get=function(){return!!this.rules.required},R.isDisabled.get=function(){return!1},R.alias.get=function(){return this._alias},R.value.get=function(){if(f(this.getter))return this.getter()},R.bails.get=function(){return this._bails},R.rejectsFalse.get=function(){return!1},P.prototype.matches=function(e){return!e||(e.id?this.id===e.id:void 0===e.name&&void 0===e.scope||(void 0===e.scope?this.name===e.name:void 0===e.name?this.scope===e.scope:e.name===this.name&&e.scope===this.scope))},P.prototype.waitFor=function(e){this._waitingFor=e},P.prototype.isWaitingFor=function(e){return this._waitingFor===e},P.prototype.update=function(e){var t,i,r,n;this.targetOf=e.targetOf||null,this.immediate=e.immediate||this.immediate||!1,this.persist=e.persist||this.persist||!1,!c(e.scope)&&e.scope!==this.scope&&f(this.validator.update)&&this.validator.update(this.id,{scope:e.scope}),this.scope=c(e.scope)?c(this.scope)?null:this.scope:e.scope,this.name=(c(e.name)?e.name:String(e.name))||this.name||null,this.rules=void 0!==e.rules?a(e.rules):this.rules,this._bails=void 0!==e.bails?e.bails:this._bails,this.listen=void 0!==e.listen?e.listen:this.listen,this.classes=!(!e.classes&&!this.classes)&&!this.componentInstance,this.classNames=v(e.classNames)?g(this.classNames,e.classNames):this.classNames,this.getter=f(e.getter)?e.getter:this.getter,this._alias=e.alias||this._alias,this.events=e.events?(t=e.events)?"string"==typeof t?t.split("|"):t:[]:this.events,this.delay=(i=this.events,r=e.delay||this.delay,n=this._delay,"number"==typeof r?i.reduce(function(e,t){return e[t]=r,e},{}):i.reduce(function(e,t){return e[t]="object"==typeof r&&t in r?r[t]:"number"==typeof n?n:n&&n[t]||0,e},{})),this.updateDependencies(),this.addActionListeners(),void 0!==e.rules&&(this.flags.required=this.isRequired),this.flags.validated&&void 0!==e.rules&&this.updated&&this.validator.validate("#"+this.id),this.updated=!0,this.updateClasses()},P.prototype.reset=function(){var t=this;this._cancellationToken&&(this._cancellationToken.cancelled=!0,delete this._cancellationToken);var i=r();Object.keys(this.flags).filter(function(e){return"required"!==e}).forEach(function(e){t.flags[e]=i[e]}),this.addActionListeners(),this.updateClasses()},P.prototype.setFlags=function(t){var i=this,r={pristine:"dirty",dirty:"pristine",valid:"invalid",invalid:"valid",touched:"untouched",untouched:"touched"};Object.keys(t).forEach(function(e){i.flags[e]=t[e],r[e]&&void 0===t[r[e]]&&(i.flags[r[e]]=!t[e])}),void 0===t.untouched&&void 0===t.touched&&void 0===t.dirty&&void 0===t.pristine||this.addActionListeners(),this.updateClasses()},P.prototype.updateDependencies=function(){var r=this;this.dependencies.forEach(function(e){return e.field.destroy()}),this.dependencies=[];var e=Object.keys(this.rules).reduce(function(e,t){return D.isTargetRule(t)&&e.push({selector:r.rules[t][0],name:t}),e},[]);e.length&&e.forEach(function(e){e.selector;var t=e.name,i={classes:r.classes,classNames:r.classNames,delay:r.delay,scope:r.scope,events:r.events.join("|"),immediate:r.immediate,targetOf:r.id};r.dependencies.push({name:t,field:new P(i)})})},P.prototype.updateClasses=function(){var e,t=this;this.classes&&!this.isDisabled&&(i(this.el)||(e=this.el,m(e,t.classNames.dirty,t.flags.dirty),m(e,t.classNames.pristine,t.flags.pristine),m(e,t.classNames.touched,t.flags.touched),m(e,t.classNames.untouched,t.flags.untouched),!c(t.flags.valid)&&t.flags.validated&&m(e,t.classNames.valid,t.flags.valid),!c(t.flags.invalid)&&t.flags.validated&&m(e,t.classNames.invalid,t.flags.invalid)))},P.prototype.addActionListeners=function(){var e,t=this;!this.el||this.el&&(k(this.el,"change",function(){t.flags.dirty=!0,t.flags.pristine=!1,t.classes&&(m(t.el,t.classNames.pristine,!1),m(t.el,t.classNames.dirty,!0))}),e=i(this.el)?"change":"blur",k(this.el,e,function(){t.flags.touched=!0,t.flags.untouched=!1,t.classes&&(m(t.el,t.classNames.touched,!0),m(t.el,t.classNames.untouched,!1))}))},P.prototype.checkValueChanged=function(){return(null!==this.initialValue||""!==this.value||(e=this.el,!y(["text","password","search","email","tel","url","textarea","number"],e.type)))&&this.value!==this.initialValue;var e},P.prototype._determineInputEvent=function(){return"change"},P.prototype._determineEventList=function(t){return this.events.length?this.events.map(function(e){return"input"===e?t:e}):[].concat(this.events).map(function(e){return"input"===e?"change":e})},P.prototype.destroy=function(){this._cancellationToken&&(this._cancellationToken.cancelled=!0),this.dependencies.forEach(function(e){return e.field.destroy()}),this.dependencies=[]},Object.defineProperties(P.prototype,R);function w(e){void 0===e&&(e=[]),this.items=e||[]}var M={length:{configurable:!0}};w.prototype["function"==typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var e=this,t=0;return{next:function(){return{value:e.items[t++],done:t>e.items.length}}}},M.length.get=function(){return this.items.length},w.prototype.find=function(t){return h(this.items,function(e){return e.matches(t)})},w.prototype.filter=function(i){return Array.isArray(i)?this.items.filter(function(t){return i.some(function(e){return t.matches(e)})}):this.items.filter(function(e){return e.matches(i)})},w.prototype.map=function(e){return this.items.map(e)},w.prototype.remove=function(e){var t=null;if(!(t=e instanceof P?e:this.find(e)))return null;var i=this.items.indexOf(t);return this.items.splice(i,1),t},w.prototype.push=function(e){if(!(e instanceof P))throw d("FieldBag only accepts instances of Field that has an id defined.");if(!e.id)throw d("Field id must be defined.");if(this.find({id:e.id}))throw d("Field with id "+e.id+" is already added.");this.items.push(e)},Object.defineProperties(w.prototype,M);function T(e,t){void 0===t&&(t={fastExit:!0}),this.errors=new O,this.fields=new w,this._createFields(e),this.paused=!1,this.fastExit=!!c(t&&t.fastExit)||t.fastExit}var q={dictionary:{configurable:!0},flags:{configurable:!0},locale:{configurable:!0}},L={dictionary:{configurable:!0},locale:{configurable:!0}};L.dictionary.get=function(){return F.getDriver()},q.dictionary.get=function(){return F.getDriver()},q.flags.get=function(){return this.fields.items.reduce(function(e,t){var i;return t.scope?e["$"+t.scope]=((i={})[t.name]=t.flags,i):e[t.name]=t.flags,e},{})},q.locale.get=function(){return T.locale},q.locale.set=function(e){T.locale=e},L.locale.get=function(){return F.getDriver().locale},L.locale.set=function(e){F.getDriver().locale=e},T.extend=function(e,t,i){void 0===i&&(i={}),T._guardExtend(e,t),T._merge(e,{validator:t,paramNames:i&&i.paramNames,options:s({},{hasTarget:!1,immediate:!0},i||{})})},T.isTargetRule=function(e){return D.isTargetRule(e)},T.prototype.localize=function(e,t){T.localize(e,t)},T.localize=function(e,t){var i,r;v(e)?F.getDriver().merge(e):(t&&(r=e||t.name,t=s({},t),F.getDriver().merge(((i={})[r]=t,i))),e&&(T.locale=e))},T.prototype.attach=function(e){var t={name:e.name,scope:e.scope,persist:!0},i=e.persist?this.fields.find(t):null;i&&(e.flags=i.flags,i.destroy(),this.fields.remove(i));var r=e.initialValue,n=new P(e);return this.fields.push(n),n.immediate?this.validate("#"+n.id,r||n.value):this._validate(n,r||n.value,{initial:!0}).then(function(e){n.flags.valid=e.valid,n.flags.invalid=!e.valid}),n},T.prototype.flag=function(e,t,i){void 0===i&&(i=null);var r=this._resolveField(e,void 0,i);r&&t&&r.setFlags(t)},T.prototype.detach=function(e,t,i){var r=f(e.destroy)?e:this._resolveField(e,t,i);r&&(r.persist||(r.destroy(),this.errors.remove(r.name,r.scope,r.vmId),this.fields.remove(r)))},T.prototype.extend=function(e,t,i){void 0===i&&(i={}),T.extend(e,t,i)},T.prototype.reset=function(e){var t=this;this.fields.filter(e).forEach(function(e){e.waitFor(null),e.reset(),t.errors.remove(e.name,e.scope)})},T.prototype.update=function(e,t){var i=t.scope;this._resolveField("#"+e)&&this.errors.update(e,{scope:i})},T.prototype.validate=function(e,t,i){var r=this;void 0===i&&(i={});var n=i.silent,s=i.scope;if(this.paused)return Promise.resolve(!0);if(c(e))return this.validateScopes({silent:n,scope:s});if("*"===e)return this.validateAll(void 0,{silent:n});if(/^(.+)\.\*$/.test(e)){var a=e.match(/^(.+)\.\*$/)[1];return this.validateAll(a)}var o=this._resolveField(e);if(!o)return this._handleFieldNotFound("unknown");n||(o.flags.pending=!0),void 0===t&&(t=o.value);var u=this._validate(o,t);return o.waitFor(u),u.then(function(e){return!n&&o.isWaitingFor(u)&&(o.waitFor(null),r._handleValidationResults([e],s)),e.valid})},T.prototype.pause=function(){return this.paused=!0,this},T.prototype.resume=function(){return this.paused=!1,this},T.prototype.validateAll=function(t,e){var i=this;void 0===e&&(e={});var r=e.silent,n=e.scope;if(this.paused)return Promise.resolve(!0);var s=null,a=!1;return"string"==typeof t?s={scope:t}:v(t)?(s=Object.keys(t).map(function(e){return{name:e,scope:n}}),a=!0):s=Array.isArray(t)?t.map(function(e){return{name:e,scope:n}}):{scope:null},Promise.all(this.fields.filter(s).map(function(e){return i._validate(e,a?t[e.name]:e.value)})).then(function(e){return r||i._handleValidationResults(e),e.every(function(e){return e.valid})})},T.prototype.validateScopes=function(e){var t=this;void 0===e&&(e={});var i=e.silent,r=e.scope;return this.paused?Promise.resolve(!0):Promise.all(this.fields.filter({scope:r}).map(function(e){return t._validate(e,e.value)})).then(function(e){return i||t._handleValidationResults(e,r),e.every(function(e){return e.valid})})},T.prototype.verify=function(e,t,n){void 0===n&&(n={});var s={name:n&&n.name||"{field}",rules:a(t),bails:u("bails",n,!0)};s.isRequired=s.rules.required;var i=Object.keys(s.rules).filter(T.isTargetRule);return i.length&&n&&v(n.values)&&i.forEach(function(e){var t=s.rules[e],i=t[0],r=t.slice(1);s.rules[e]=[n.values[i]].concat(r)}),this._validate(s,e).then(function(e){return{valid:e.valid,errors:e.errors.map(function(e){return e.msg})}})},T.prototype.destroy=function(){},T.prototype._createFields=function(i){var r=this;i&&Object.keys(i).forEach(function(e){var t=s({},{name:e,rules:i[e]});r.attach(t)})},T.prototype._getDateFormat=function(e){var t=null;return e.date_format&&Array.isArray(e.date_format)&&(t=e.date_format[0]),t||F.getDriver().getDateFormat(this.locale)},T.prototype._formatErrorMessage=function(e,t,i,r){void 0===i&&(i={}),void 0===r&&(r=null);var n=this._getFieldDisplayName(e),s=this._getLocalizedParams(t,r);return F.getDriver().getFieldMessage(this.locale,e.name,t.name,[n,s,i])},T.prototype._convertParamObjectToArray=function(i,e){if(Array.isArray(i))return i;var t=D.getParamNames(e);return t&&v(i)?t.reduce(function(e,t){return t in i&&e.push(i[t]),e},[]):i},T.prototype._getLocalizedParams=function(e,t){void 0===t&&(t=null);var i=this._convertParamObjectToArray(e.params,e.name);return e.options.hasTarget&&i&&i[0]?[t||F.getDriver().getAttribute(this.locale,i[0],i[0])].concat(i.slice(1)):i},T.prototype._getFieldDisplayName=function(e){return e.alias||F.getDriver().getAttribute(this.locale,e.name,e.name)},T.prototype._convertParamArrayToObj=function(t,e){var r=D.getParamNames(e);if(!r)return t;if(v(t)){if(r.some(function(e){return-1!==Object.keys(t).indexOf(e)}))return t;t=[t]}return t.reduce(function(e,t,i){return e[r[i]]=t,e},{})},T.prototype._test=function(r,e,n){var t,i,s=this,a=D.getValidatorMethod(n.name),o=(o=Array.isArray(n.params)?p(n.params):n.params)||[],u=null;if(!a||"function"!=typeof a)return Promise.reject(d("No such validator '"+n.name+"' exists."));n.options.hasTarget&&r.dependencies?(t=h(r.dependencies,function(e){return e.name===n.name}))&&(u=t.field.alias,o=[t.field.value].concat(o.slice(1))):"required"===n.name&&r.rejectsFalse&&(o=o.length?o:[!0]),n.options.isDate&&(i=this._getDateFormat(r.rules),"date_format"!==n.name&&o.push(i));var l=a(e,this._convertParamArrayToObj(o,n.name));return f(l.then)?l.then(function(e){var t=!0,i={};return Array.isArray(e)?t=e.every(function(e){return v(e)?e.valid:e}):(t=v(e)?e.valid:e,i=e.data),{valid:t,errors:t?[]:[s._createFieldError(r,n,i,u)]}}):(v(l)||(l={valid:l,data:{}}),{valid:l.valid,errors:l.valid?[]:[this._createFieldError(r,n,l.data,u)]})},T._merge=function(e,t){var i=t.validator,r=t.options,n=t.paramNames,s=f(i)?i:i.validate;i.getMessage&&F.getDriver().setMessage(T.locale,e,i.getMessage),D.add(e,{validate:s,options:r,paramNames:n})},T._guardExtend=function(e,t){if(!f(t)&&!f(t.validate))throw d("Extension Error: The validator '"+e+"' must be a function or have a 'validate' method.")},T.prototype._createFieldError=function(e,t,i,r){var n=this;return{id:e.id,field:e.name,msg:this._formatErrorMessage(e,t,i,r),rule:t.name,scope:e.scope,regenerate:function(){return n._formatErrorMessage(e,t,i,r)}}},T.prototype._resolveField=function(e,t,i){if("#"===e[0])return this.fields.find({id:e.slice(1)});if(!c(t))return this.fields.find({name:e,scope:t});if(y(e,".")){var r=e.split("."),n=r[0],s=r.slice(1),a=this.fields.find({name:s.join("."),scope:n});if(a)return a}return this.fields.find({name:e,scope:null,vmId:i})},T.prototype._handleFieldNotFound=function(e,t){var i=c(t)?e:(c(t)?"":t+".")+e;return Promise.reject(d('Validating a non-existent field: "'+i+'". Use "attach()" first.'))},T.prototype._handleValidationResults=function(i){var t=this,e=i.map(function(e){return{id:e.id}});this.errors.removeById(e.map(function(e){return e.id})),i.forEach(function(e){t.errors.remove(e.field,e.scope)});var r=i.reduce(function(e,t){return e.push.apply(e,t.errors),e},[]);this.errors.add(r),this.fields.filter(e).forEach(function(t){var e=h(i,function(e){return e.id===t.id});t.setFlags({pending:!1,valid:e.valid,validated:!0})})},T.prototype._shouldSkip=function(e,t){return!1!==e.bails&&(!!e.isDisabled||!e.isRequired&&(c(t)||""===t||(i=t,Array.isArray(i)&&0===i.length)));var i},T.prototype._shouldBail=function(e){return void 0!==e.bails?e.bails:this.fastExit},T.prototype._validate=function(r,n,e){var s=this;void 0===e&&(e={});var t=e.initial,i=Object.keys(r.rules).filter(D.isRequireRule);if(r.forceRequired=!1,i.forEach(function(e){var t=D.getOptions(e),i=s._test(r,n,{name:e,params:r.rules[e],options:t});if(f(i.then))throw d("Require rules cannot be async");if(!v(i))throw d("Require rules has to return an object (see docs)");!0===i.data.required&&(r.forceRequired=!0)}),this._shouldSkip(r,n))return Promise.resolve({valid:!0,id:r.id,field:r.name,scope:r.scope,errors:[]});var a=[],o=[],u=!1;return f(r.checkValueChanged)&&(r.flags.changed=r.checkValueChanged()),Object.keys(r.rules).filter(function(e){return!t||!D.has(e)||D.isImmediate(e)}).some(function(e){var t=D.getOptions(e),i=s._test(r,n,{name:e,params:r.rules[e],options:t});return f(i.then)?a.push(i):!i.valid&&s._shouldBail(r)?(o.push.apply(o,i.errors),u=!0):a.push(new Promise(function(e){return e(i)})),u}),u?Promise.resolve({valid:!1,errors:o,id:r.id,field:r.name,scope:r.scope}):Promise.all(a).then(function(e){return e.reduce(function(e,t){var i;return t.valid||(i=e.errors).push.apply(i,t.errors),e.valid=e.valid&&t.valid,e},{valid:!0,errors:o,id:r.id,field:r.name,scope:r.scope})})},Object.defineProperties(T.prototype,q),Object.defineProperties(T,L);function V(e,t){this.i18n=e,this.rootKey=t}var C=function(i){return v(i)?Object.keys(i).reduce(function(e,t){return e[t]=C(i[t]),e},{}):f(i)?i("{0}",["{1}","{2}","{3}"]):i},I={locale:{configurable:!0}};I.locale.get=function(){return this.i18n.locale},I.locale.set=function(e){n("Cannot set locale from the validator when using vue-i18n, use i18n.locale setter instead")},V.prototype.getDateFormat=function(e){return this.i18n.getDateTimeFormat(e||this.locale)},V.prototype.setDateFormat=function(e,t){this.i18n.setDateTimeFormat(e||this.locale,t)},V.prototype.getMessage=function(e,t,i){var r=this.rootKey+".messages."+t,n=this.i18n.t(r,i);return n!==r?n:this.i18n.t(this.rootKey+".messages._default",i)},V.prototype.getAttribute=function(e,t,i){void 0===i&&(i="");var r=this.rootKey+".attributes."+t,n=this.i18n.t(r);return n!==r?n:i},V.prototype.getFieldMessage=function(e,t,i,r){var n=this.rootKey+".custom."+t+"."+i,s=this.i18n.t(n,r);return s!==n?s:this.getMessage(e,i,r)},V.prototype.merge=function(a){var o=this;Object.keys(a).forEach(function(e){var t,i,r,n=g({},u(e+"."+o.rootKey,o.i18n.messages,{})),s=g(n,(i=a[e],r={},i.messages&&(r.messages=C(i.messages)),i.custom&&(r.custom=C(i.custom)),i.attributes&&(r.attributes=i.attributes),c(i.dateFormat)||(r.dateFormat=i.dateFormat),r));o.i18n.mergeLocaleMessage(e,((t={})[o.rootKey]=s,t)),s.dateFormat&&o.i18n.setDateTimeFormat(e,s.dateFormat)})},V.prototype.setMessage=function(e,t,i){var r,n;this.merge(((n={})[e]={messages:((r={})[t]=i,r)},n))},V.prototype.setAttribute=function(e,t,i){var r,n;this.merge(((n={})[e]={attributes:((r={})[t]=i,r)},n))},Object.defineProperties(V.prototype,I);function S(e){this.configure(e),this._validator=new T(null,{fastExit:e&&e.fastExit}),this._initI18n(this.config)}var $=s({},{locale:"en",delay:0,errorBagName:"errors",dictionary:null,fieldsBagName:"fields",classes:!1,classNames:null,events:"input",inject:!0,fastExit:!0,aria:!0,validity:!1,useConstraintAttrs:!0,i18n:null,i18nRootKey:"validation"}),B={i18nDriver:{configurable:!0},config:{configurable:!0}},K={i18nDriver:{configurable:!0},config:{configurable:!0}};S.setI18nDriver=function(e,t){F.setDriver(e,t)},S.configure=function(e){$=s({},$,e)},S.use=function(e,t){if(void 0===t&&(t={}),!f(e))return n("The plugin must be a callable function");e({Validator:T,ErrorBag:O,Rules:T.rules},t)},B.i18nDriver.get=function(){return F.getDriver()},K.i18nDriver.get=function(){return F.getDriver()},B.config.get=function(){return $},K.config.get=function(){return $},S.prototype._initI18n=function(e){var t=e.dictionary,i=e.i18n,r=e.i18nRootKey,n=e.locale;i&&S.setI18nDriver("i18n",new V(i,r)),t&&this.i18nDriver.merge(t),n&&!i&&this._validator.localize(n)},S.prototype.configure=function(e){S.configure(e)},Object.defineProperties(S.prototype,B),Object.defineProperties(S,K),S.Validator=T,S.ErrorBag=O;function z(i,r){var n={pristine:function(e,t){return e&&t},dirty:function(e,t){return e||t},touched:function(e,t){return e||t},untouched:function(e,t){return e&&t},valid:function(e,t){return e&&t},invalid:function(e,t){return e||t},pending:function(e,t){return e||t},required:function(e,t){return e||t},validated:function(e,t){return e&&t}};return Object.keys(n).reduce(function(e,t){return e[t]=n[t](i[t],r[t]),e},{})}var W=function(r,n){return void 0===n&&(n=!0),Object.keys(r).reduce(function(e,t){if(!e)return e=s({},r[t]);var i=0===t.indexOf("$");return n&&i?z(W(r[t]),e):!n&&i?e:e=z(e,r[t])},null)};return S.version="3.3.1",S.mapFields=function(e){if(!e)return function(){return W(this.$validator.flags)};var t,s=(t=e,Array.isArray(t)?t.reduce(function(e,t){return y(t,".")?e[t.split(".")[1]]=t:e[t]=t,e},{}):t);return Object.keys(s).reduce(function(e,r){var n=s[r];return e[r]=function(){if(this.$validator.flags[n])return this.$validator.flags[n];if("*"===s[r])return W(this.$validator.flags,!1);if(n.indexOf(".")<=0)return{};var e=n.split("."),t=e[0],i=e.slice(1),t=this.$validator.flags["$"+t];return"*"===(i=i.join("."))&&t?W(t):t&&t[i]?t[i]:{}},e},{})},S});